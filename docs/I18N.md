# Multi-Language (i18n) Documentation

## Overview

ComSpace platform supports **10+ languages** across backend, frontend, and mobile applications:

- üá∫üá∏ **English** (en) - Default
- üá™üá∏ **Spanish** (es)
- üá´üá∑ **French** (fr)
- üá∏üá¶ **Arabic** (ar) - RTL support
- üá©üá™ **German** (de)
- üá®üá≥ **Chinese** (zh)
- üáØüáµ **Japanese** (ja)
- üáµüáπ **Portuguese** (pt)
- üá∑üá∫ **Russian** (ru)
- üáÆüá≥ **Hindi** (hi)

## Features

‚úÖ **Auto-detection**: Detects user's browser/device language  
‚úÖ **Manual switching**: Users can change language anytime  
‚úÖ **Persistent**: Language preference saved in cookies/storage  
‚úÖ **RTL support**: Right-to-left for Arabic  
‚úÖ **SEO-friendly**: Language-specific URLs  
‚úÖ **Content translation**: Products, categories, emails

---

## Backend Implementation

### Dependencies

```json
{
  "i18next": "^23.7.16",
  "i18next-http-middleware": "^3.5.0",
  "i18next-fs-backend": "^2.3.1"
}
```

### Configuration

File: `backend/src/config/i18n.ts`

```typescript
import i18next from 'i18next';
import i18nextHttpMiddleware from 'i18next-http-middleware';
import Backend from 'i18next-fs-backend';

i18next
  .use(Backend)
  .use(i18nextHttpMiddleware.LanguageDetector)
  .init({
    fallbackLng: 'en',
    preload: ['en', 'es', 'fr', 'ar', 'de'],
    supportedLngs: ['en', 'es', 'fr', 'ar', 'de', 'zh', 'ja', 'pt', 'ru', 'hi'],
    detection: {
      order: ['querystring', 'cookie', 'header'],
      lookupQuerystring: 'lang',
      lookupCookie: 'i18next',
      lookupHeader: 'accept-language',
    },
  });
```

### Translation Files

Located in: `backend/src/locales/{lang}/translation.json`

Example structure:
```json
{
  "common": {
    "welcome": "Welcome",
    "error": "Error",
    "success": "Success"
  },
  "auth": {
    "loginSuccess": "Login successful",
    "invalidCredentials": "Invalid email or password"
  },
  "product": {
    "created": "Product created successfully",
    "notFound": "Product not found"
  }
}
```

### Usage in Controllers

```typescript
import { Request, Response } from 'express';

export const loginController = async (req: Request, res: Response) => {
  try {
    // Access translations
    const message = req.t('auth.loginSuccess');
    
    res.json({
      success: true,
      message, // Translated message
    });
  } catch (error) {
    res.status(400).json({
      success: false,
      message: req.t('auth.loginFailed'),
    });
  }
};
```

### Language Detection Middleware

File: `backend/src/middleware/language.ts`

```typescript
export const languageMiddleware = (req, res, next) => {
  // Priority: query > cookie > header
  const language = req.query.lang || req.cookies.i18next || 
                   req.headers['accept-language']?.split(',')[0] || 'en';
  
  req.language = language.split('-')[0].toLowerCase();
  next();
};
```

### Multi-Language Database Models

File: `backend/src/models/MultiLang.ts`

```typescript
interface IMultiLangContent {
  en: string;
  es?: string;
  fr?: string;
  ar?: string;
  // ... other languages
}

// Product model with translations
const ProductSchema = new Schema({
  name: {
    en: { type: String, required: true },
    es: String,
    fr: String,
    // ... other languages
  },
  description: {
    en: { type: String, required: true },
    es: String,
    // ... other languages
  },
});

// Helper function
export const getLocalizedContent = (content: IMultiLangContent, lang: string) => {
  return content[lang] || content.en;
};
```

---

## Frontend Implementation (Next.js)

### Dependencies

```json
{
  "next-intl": "^3.4.5"
}
```

### Configuration

File: `frontend/src/i18n.ts`

```typescript
import { getRequestConfig } from 'next-intl/server';

export const locales = ['en', 'es', 'fr', 'ar', 'de'] as const;
export const defaultLocale = 'en';

export default getRequestConfig(async ({ locale }) => {
  return {
    messages: (await import(`./locales/${locale}.json`)).default,
  };
});
```

### Middleware

File: `frontend/src/middleware.ts`

```typescript
import createMiddleware from 'next-intl/middleware';
import { locales, defaultLocale } from './i18n';

export default createMiddleware({
  locales,
  defaultLocale,
  localePrefix: 'as-needed',
});
```

### Translation Files

Located in: `frontend/src/locales/{lang}.json`

Example structure:
```json
{
  "nav": {
    "home": "Home",
    "products": "Products",
    "cart": "Cart"
  },
  "home": {
    "hero": {
      "title": "Welcome to ComSpace",
      "shopNow": "Shop Now"
    }
  }
}
```

### Usage in Components

```tsx
import { useTranslations } from 'next-intl';

export default function HomePage() {
  const t = useTranslations();

  return (
    <div>
      <h1>{t('home.hero.title')}</h1>
      <button>{t('home.hero.shopNow')}</button>
    </div>
  );
}
```

### Language Switcher Component

File: `frontend/src/components/LanguageSwitcher.tsx`

```tsx
'use client';

import { useRouter, usePathname } from 'next/navigation';
import { locales, localeNames } from '@/i18n';

export default function LanguageSwitcher({ currentLocale }) {
  const router = useRouter();
  const pathname = usePathname();

  const switchLanguage = (newLocale) => {
    const pathnameWithoutLocale = pathname.replace(/^\/[a-z]{2}/, '');
    const newPath = newLocale === 'en' 
      ? pathnameWithoutLocale 
      : `/${newLocale}${pathnameWithoutLocale}`;
    
    router.push(newPath);
    document.cookie = `NEXT_LOCALE=${newLocale};path=/`;
  };

  return (
    <select value={currentLocale} onChange={(e) => switchLanguage(e.target.value)}>
      {locales.map((locale) => (
        <option key={locale} value={locale}>
          {localeNames[locale]}
        </option>
      ))}
    </select>
  );
}
```

### Layout with Localization

File: `frontend/src/app/[locale]/layout.tsx`

```tsx
import { NextIntlClientProvider } from 'next-intl';

export default async function LocaleLayout({ children, params: { locale } }) {
  const messages = (await import(`@/locales/${locale}.json`)).default;

  return (
    <html lang={locale} dir={locale === 'ar' ? 'rtl' : 'ltr'}>
      <body>
        <NextIntlClientProvider locale={locale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}
```

---

## Mobile Implementation (React Native)

### Dependencies

```json
{
  "i18next": "^23.7.16",
  "react-i18next": "^14.0.0",
  "expo-localization": "~14.8.0"
}
```

### Configuration

File: `mobile/src/i18n/index.ts`

```typescript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import * as Localization from 'expo-localization';
import AsyncStorage from '@react-native-async-storage/async-storage';

import en from './locales/en.json';
import es from './locales/es.json';
// ... other imports

const deviceLanguage = Localization.locale.split('-')[0];

i18n
  .use(initReactI18next)
  .init({
    resources: {
      en: { translation: en },
      es: { translation: es },
      // ... other languages
    },
    lng: deviceLanguage,
    fallbackLng: 'en',
  });

// Persist language preference
AsyncStorage.getItem('@comspace_language').then((savedLanguage) => {
  if (savedLanguage) i18n.changeLanguage(savedLanguage);
});

i18n.on('languageChanged', (lng) => {
  AsyncStorage.setItem('@comspace_language', lng);
});
```

### Usage in Screens

```tsx
import { useTranslation } from 'react-i18next';

export default function HomeScreen() {
  const { t } = useTranslation();

  return (
    <View>
      <Text>{t('home.welcome')}</Text>
      <Button title={t('home.shopNow')} />
    </View>
  );
}
```

### Language Switcher Component

File: `mobile/src/components/LanguageSwitcher.tsx`

```tsx
import { useTranslation } from 'react-i18next';
import { Modal, FlatList, TouchableOpacity } from 'react-native';

const languages = [
  { code: 'en', name: 'English', flag: 'üá∫üá∏' },
  { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },
  // ... other languages
];

export default function LanguageSwitcher() {
  const { i18n } = useTranslation();

  return (
    <FlatList
      data={languages}
      renderItem={({ item }) => (
        <TouchableOpacity onPress={() => i18n.changeLanguage(item.code)}>
          <Text>{item.flag} {item.name}</Text>
        </TouchableOpacity>
      )}
    />
  );
}
```

---

## API Usage

### Setting Language via Query Parameter

```bash
GET /api/products?lang=es
```

### Setting Language via Header

```bash
GET /api/products
Accept-Language: es-ES,es;q=0.9
```

### Setting Language via Cookie

```bash
GET /api/products
Cookie: i18next=fr
```

---

## Adding New Languages

### 1. Backend

1. Create translation file: `backend/src/locales/{lang}/translation.json`
2. Copy structure from `en/translation.json`
3. Translate all strings
4. Add language code to `preload` and `supportedLngs` in `i18n.ts`

### 2. Frontend

1. Create translation file: `frontend/src/locales/{lang}.json`
2. Copy structure from `en.json`
3. Translate all strings
4. Add language to `locales` array in `i18n.ts`
5. Add language name to `localeNames` object

### 3. Mobile

1. Create translation file: `mobile/src/i18n/locales/{lang}.json`
2. Import in `mobile/src/i18n/index.ts`
3. Add to `resources` object
4. Add to `languages` array in `LanguageSwitcher`

---

## Translation Best Practices

### 1. Use Keys, Not Hardcoded Text

‚ùå Bad:
```tsx
<Text>Welcome to our store</Text>
```

‚úÖ Good:
```tsx
<Text>{t('home.welcome')}</Text>
```

### 2. Organize by Feature

```json
{
  "home": { ... },
  "product": { ... },
  "cart": { ... }
}
```

### 3. Use Interpolation

```json
{
  "greeting": "Hello {{name}}!"
}
```

```tsx
t('greeting', { name: 'John' }); // "Hello John!"
```

### 4. Handle Plurals

```json
{
  "itemsInCart": "{{count}} item",
  "itemsInCart_plural": "{{count}} items"
}
```

```tsx
t('itemsInCart', { count: 5 }); // "5 items"
```

### 5. Provide Context

```json
{
  "button": {
    "submit": "Submit",
    "cancel": "Cancel"
  }
}
```

---

## RTL (Right-to-Left) Support

### Frontend

```tsx
<html dir={locale === 'ar' ? 'rtl' : 'ltr'}>
```

### Mobile

```tsx
import { I18nManager } from 'react-native';

if (language === 'ar') {
  I18nManager.forceRTL(true);
} else {
  I18nManager.forceRTL(false);
}
```

### CSS

```css
[dir='rtl'] .element {
  margin-left: auto;
  margin-right: 16px;
}
```

---

## Testing

### Test Language Switching

```bash
# Backend
curl -H "Accept-Language: es" http://localhost:5000/api/products

# Frontend
http://localhost:3000/es/products

# Query parameter
http://localhost:3000/products?lang=fr
```

### Test RTL

```bash
http://localhost:3000/ar/products
```

---

## Troubleshooting

### Language Not Changing

1. Check if language code is in `supportedLngs`
2. Verify translation file exists
3. Check cookie/localStorage persistence
4. Clear browser cache

### Missing Translations

1. Check if key exists in translation file
2. Verify fallback language (English) has the key
3. Check console for i18n warnings

### RTL Issues

1. Ensure `dir="rtl"` is set on html/body
2. Use logical CSS properties (margin-inline-start vs margin-left)
3. Test with actual Arabic content

---

## Performance Tips

1. **Lazy load translations**: Only load needed languages
2. **Cache translations**: Use Redis/memory cache
3. **Bundle size**: Only include active languages in build
4. **CDN**: Serve translation files from CDN

---

## Resources

- [i18next Documentation](https://www.i18next.com/)
- [next-intl Documentation](https://next-intl-docs.vercel.app/)
- [React i18next Documentation](https://react.i18next.com/)
- [Expo Localization](https://docs.expo.dev/versions/latest/sdk/localization/)

---

**Language support added**: January 2026  
**Last updated**: January 16, 2026
